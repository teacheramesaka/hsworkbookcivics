<!DOCTYPE HTML>
<html lang="en">
<head>
    {%- include head.html -%}

    {% if page.previous %}
        <link rel="prev" href="{{site.baseurl}}{{page.previous.url}}" />
    {% else %}
        <link rel="prev" href="{{site.baseurl}}/" />
    {% endif %}

    {% if page.next %}
        <link rel="next" href="{{site.baseurl}}{{page.next.url}}" />
    {% endif %}
    <style>
        .toc {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            background: #f9f9f9;
        }

        .toc h2 {
            margin-top: 0;
        }

        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }

        .toc ul li {
            margin: 5px 0;
        }

        .toc-level-2 {
            margin-left: 20px;
        }

        .toc-level-3 {
            margin-left: 40px;
        }

        .toc-level-4 {
            margin-left: 60px;
        }
    </style>
</head>
<body>
    <div class="book">

        <div class="book-body">
            <div class="book-header" role="navigation">
                {% if page.show_title != false %}
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        {% if page.title %}
                            <a href="." >{{ page.title | escape }}</a>
                        {% else %}
                            <a href="." >{{ site.title | escape }}</a>
                        {% endif %}
                    </h1>
                {% endif %}
            </div>

            <div class="body-inner">
                <!-- 目次をページ本体の上部に表示 -->
                <div class="toc">
                    <h2>目次</h2>
                    <ul id="toc-list"></ul>
                </div>

                {%- include body.html -%}

                {% if page.previous %}
                    <a href="{{site.baseurl}}{{page.previous.url}}" class="navigation navigation-prev navigation-unique" aria-label="Previous page: {{page.previous.title}}">
                        <i class="fa fa-angle-left"></i>
                    </a>
                {% else %}
                    <a href="{{site.baseurl}}/" class="navigation navigation-prev navigation-unique" aria-label="Previous page: {{site.title}}">
                        <i class="fa fa-angle-left"></i>
                    </a>
                {% endif %}

                {% if page.next %}
                    <a href="{{site.baseurl}}{{page.next.url}}" class="navigation navigation-next navigation-unique" aria-label="Next page: {{page.next.title}}">
                        <i class="fa fa-angle-right"></i>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var content = document.querySelector('.body-inner').innerHTML;
            var tocList = document.getElementById('toc-list');
            var headers = content.match(/<h[1-4]>.*?<\/h[1-4]>/g);

            if (headers) {
                headers.forEach(function(header) {
                    var level = header.match(/<h([1-4])>/)[1];
                    var text = header.replace(/<.*?>/g, '');
                    var id = text.toLowerCase().replace(/[^\w]+/g, '-');

                    var li = document.createElement('li');
                    li.classList.add('toc-level-' + level);
                    var a = document.createElement('a');
                    a.href = '#' + id;
                    a.textContent = text;
                    li.appendChild(a);
                    tocList.appendChild(li);

                    // Set ID to the header
                    content = content.replace(header, '<h' + level + ' id="' + id + '">' + text + '</h' + level + '>');
                });

                document.querySelector('.body-inner').innerHTML = content;
            }
        });
    </script>

    <script>
    var gitbook = gitbook || [];
    gitbook.push(function() {
        gitbook.page.hasChanged({%- include metadata-post.json.tpl -%});
    });
    </script>

    {%- include footer.html -%}

</body>
</html>